# Placing Analysis

This page seeks to see if there are underlying trends based one what placing a competitor took in both the Absolute class and their own weight class.

```{r}
#| message: false
#| warning: false
#| include: false
library(here)
library(data.table)
library(dplyr)
library(ggplot2)
library(scales)
library(forcats)

Path_Data <- file.path("C:/Users/grant/OneDrive/Road To DE/Data Projects/BJJ Absolute Class Analysis/data")
File_Absolute_Results <- "IBJJF_Results_Absolute.rds"
File_Results <- "IBJJF_Results_Weight_Class.rds"
dt_Results <- readRDS(file.path(Path_Data,File_Results))
dt_Absolute_Results <- readRDS(file.path(Path_Data,File_Absolute_Results))

```

## Weight Class Breakdown

When we look at each individual placing, 1 through 3, in the absolute and compare it to the weight weight class of the competitor a few insights appear.

1.  We see the general trend of Medium Heavy to Super Heavy being the weight classes that perform the best that we saw in our overview still holds even at the individual placing level.
2.  More intrestingly we see taking 2nd and 3rd in the absolute have very similair breakdowns of weight classes, but for taking 1st we see a much higher proportion of competitors fall in the Heavy and particularly the Super Heavy classes, with the Medium Heavy weight class having a significant drop off. The Super Heavy and Heavy weight classes by themselves make up 50% of the 1st place winners.\

```{r}
#| echo: false
#| #Placings Analysis
#Do we see certain weight classes taking absolute placing 1, 2, or 3?
dt_Placings <- dt_Absolute_Results[!is.na(Weight_Class), .(Weight_Class,Placing_Absolute,Placing_Weight_Class)]
dt_Placings_Absolute <- dt_Placings
dt_Placings_Absolute <- dt_Placings_Absolute[, .N, by = c("Weight_Class", "Placing_Absolute")]
dt_Placings_Absolute <- dt_Placings_Absolute[, Total := sum(N), by = c("Placing_Absolute")]
dt_Placiings_Absolute <- dt_Placings_Absolute[, Proportion := round(N/Total,3) ]
setorder(dt_Placings_Absolute, Placing_Absolute,Weight_Class)

dt_Placings_Absolute %>%
  ggplot(aes(x = Placing_Absolute, y = Proportion, fill = fct_rev(Weight_Class)))+
  geom_bar(stat = "identity") +
  geom_text(
    data =  subset(dt_Placings_Absolute, Proportion >= 0.05),
    aes(label = paste0((Proportion * 100),"%")),
            position = position_stack(vjust = 0.9),
            color = "white", size = 3.5) +
  scale_y_continuous(labels = label_percent())+
labs(
    title = "Proportion of Placings",
    subtitle = "by Weight Class",
    fill = "Weight Class",
    x = "Absolute Placing",
    y = "Proportion"
  )+
  theme_minimal() +
  theme(
    plot.title = element_text(size = 20, face = "bold"),
    plot.subtitle = element_text(size = 12),
    axis.title.x = element_text(size = 15,face = "bold"),
    axis.title.y = element_text(size = 15,face = "bold"),
    axis.text.x = element_text( size = 10,face = "bold")
  )
```

## Comparison of Weight Class Placing and Absolute Placing

When looking at the relationship between how well a competitor placed in their weight class in comparison to the Absolute class, unsurprisingly we see that the better a competitor does in their weight class the more likely they are to do well in the absolute class. Although it is still striking to see that nearly %80 of 1st place winners of the absolute took 1st int their weight class. In short taking 1st in your weight class is a very strong signal you will perform well in the absolute.

```{r}
#| echo: false
#Do people who place high in their weight class place high in the absolute or does it not matter?
dt_Placings_Weight_Class <- dt_Placings
#Because the IBJJF source data is not super clean. Have to filter out records where I was able to get a Weight class for a competitor based on another years results
#but they did not actually have a wieght class record/placing for the specific tournament/observation.
dt_Placings_Weight_Class <- dt_Placings_Weight_Class[!is.na(Placing_Weight_Class)]
dt_Placings_Weight_Class <- dt_Placings_Weight_Class[, .N, by = c("Placing_Weight_Class", "Placing_Absolute")]
dt_Placings_Weight_Class <- dt_Placings_Weight_Class[, Total := sum(N), by = c("Placing_Absolute")]
dt_Placings_Weight_Class <- dt_Placings_Weight_Class[, Proportion := round(N/Total,3) ]
setorder(dt_Placings_Weight_Class,Placing_Absolute,Placing_Weight_Class)
dt_Placings_Weight_Class <- dt_Placings_Weight_Class[, Placing_Weight_Class := factor(Placing_Weight_Class, levels = c(3,2,1))]

dt_Placings_Weight_Class %>%
  ggplot(aes(x = Placing_Absolute, y = Proportion, fill = Placing_Weight_Class))+
   geom_bar(stat = "identity") +
   geom_text(
    aes(label = paste0((Proportion * 100),"%")),
    position = position_stack(vjust = 0.5),
    color = "white", size = 3.5) +
   scale_y_continuous(labels = label_percent())+
  labs(
    title = "Proportion of Placings",
    subtitle = "by Weight Class Placing",
    fill = "Weight Class Placing",
    x = "Absolute Placing",
    y = "Proportion"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 20, face = "bold"),
    plot.subtitle = element_text(size = 12),
    axis.title.x = element_text(size = 15,face = "bold"),
    axis.title.y = element_text(size = 15,face = "bold"),
    axis.text.x = element_text( size = 10,face = "bold")
  )
```

Note: Graph How many Competitors placed in the absolute per weight class placing. I.e. 100 competitors who took 1st in their weight class made the absolute podium. 200 competitors who took 2nd in their weight class made the absolute podium. etc... Will do soon.
